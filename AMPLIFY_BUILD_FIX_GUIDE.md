# AWS Amplify Build Fix Guide for Kointoss

## Issue: "No file or variants found for asset: amplify_outputs.json"

This error occurs because the Flutter app expects an `amplify_outputs.json` file that is normally generated when you configure AWS Amplify backend services. Since we're deploying the frontend first without backend configuration, we need to work around this.

## Solution Applied

### 1. Created Dummy `amplify_outputs.json`
We've created a placeholder `amplify_outputs.json` file with dummy values to satisfy the build requirement:

```json
{
  "version": "1",
  "auth": {
    "user_pool_id": "dummy-user-pool-id",
    "aws_region": "us-east-1",
    "user_pool_client_id": "dummy-client-id"
  },
  "api": {
    "plugins": {
      "awsAPIPlugin": {
        "kointos": {
          "endpointType": "GraphQL",
          "endpoint": "https://dummy-endpoint.appsync-api.us-east-1.amazonaws.com/graphql",
          "region": "us-east-1",
          "authorizationType": "AMAZON_COGNITO_USER_POOLS"
        }
      }
    }
  },
  "storage": {
    "plugins": {
      "awsS3StoragePlugin": {
        "bucket": "dummy-bucket-name",
        "region": "us-east-1"
      }
    }
  }
}
```

### 2. Updated `amplify.yml`
The build configuration now:
- Installs Flutter SDK during build
- Uses HTML renderer for better web compatibility
- Includes debugging commands to verify file presence
- Caches Flutter dependencies for faster builds

## Next Steps

1. **Commit and Push Changes**:
   ```bash
   git add amplify_outputs.json amplify.yml
   git commit -m "Fix Amplify build: Add dummy amplify_outputs.json"
   git push
   ```

2. **Trigger New Build in Amplify Console**:
   - Go to AWS Amplify Console
   - Click "Redeploy this version" or wait for automatic build

3. **Monitor Build Logs**:
   - Check that Flutter installs successfully
   - Verify `amplify_outputs.json` is found
   - Ensure build completes without errors

## Alternative Approach (If Build Still Fails)

If the build continues to fail, you can modify the app to work without Amplify temporarily:

1. **Create a build-time flag** in `lib/core/services/kointos_amplify_config.dart`:

```dart
static Future<void> configureAmplify() async {
  if (_isConfigured) return;

  try {
    // Skip Amplify configuration in web builds if no real config exists
    if (kIsWeb && const String.fromEnvironment('SKIP_AMPLIFY') == 'true') {
      LoggerService.info('Skipping Amplify configuration for web build');
      _isConfigured = true;
      return;
    }

    // ... rest of the configuration
  } catch (e) {
    // Handle error
  }
}
```

2. **Update build command** in `amplify.yml`:
```yaml
build:
  commands:
    - flutter build web --release --dart-define=SKIP_AMPLIFY=true
```

## Setting Up Real Backend (Later)

Once you're ready to configure the actual AWS backend:

1. **Install Amplify CLI locally**:
   ```bash
   npm install -g @aws-amplify/cli
   ```

2. **Pull the Amplify app**:
   ```bash
   amplify pull --appId YOUR_APP_ID --envName main
   ```

3. **Configure backend services**:
   ```bash
   amplify add auth
   amplify add api
   amplify add storage
   amplify push
   ```

4. **Replace dummy `amplify_outputs.json`** with the real one generated by Amplify

## Troubleshooting

### Build fails with "Flutter command not found"
- The Flutter SDK installation might be failing
- Check if the Git clone command has network access

### Build fails with dependency errors
- Clear the build cache in Amplify Console
- Check if all dependencies in `pubspec.yaml` are compatible

### Build succeeds but app shows errors
- The dummy Amplify configuration will cause runtime errors
- This is expected until you configure real AWS services
- The app should still load and display UI, but backend features won't work

## Support

For additional help:
1. Check AWS Amplify build logs for detailed error messages
2. Review Flutter web build documentation
3. Ensure all files are committed to your repository